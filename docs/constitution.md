# constitution.md — 品質の非交渉条件

## コード品質原則

1. **型安全性**: any型・force unwrap禁止。Optional は適切にハンドリング
2. **単一責任**: 1つのクラス/構造体は1つの責務のみ
3. **DRY**: 同じロジックの重複禁止。共通化して Utils/ または Components/ に配置
4. **テスト必須**: 新機能にはユニットテスト。ビジネスロジックのカバレッジ80%以上
5. **エラーハンドリング**: 全ての失敗可能な処理に適切なエラーハンドリングを実装
6. **ログ出力**: 複雑な処理フローには os.Logger を使ったデバッグログを実装

## iOS固有原則

7. **HIG準拠**: Apple Human Interface Guidelinesを遵守
8. **アクセシビリティ**: VoiceOver・Dynamic Type に対応
9. **ダークモード**: 完全対応。ハードコードされた色は禁止
10. **パフォーマンス**: メインスレッドをブロックしない。重い処理はバックグラウンドで
11. **メモリ管理**: 循環参照に [weak self] を使用
12. **プライバシー**: 必要最小限のデータのみ取得。Info.plist の Usage Description を適切に記述

## 開発プロセス原則

13. **段階的実装**: 一度に1つの機能を完成させる。複数機能の並行着手禁止
14. **動作確認優先**: 書いたコードは必ずビルド・実行して動作確認
15. **最小依存**: 外部ライブラリは最終手段。標準ライブラリを優先
16. **セルフレビュー**: 実装完了後、チェックリストに沿ってレビューしてから報告

---

# 品質チェックリスト（タスク完了時に毎回確認）

## ✅ 動作の正しさ
- [ ] 正常系が期待通り動作する
- [ ] 異常系（nil、空配列、ネットワークエラー）を処理している
- [ ] エッジケース（0件、1件、大量データ、文字数制限）を考慮している
- [ ] ビルドが通る
- [ ] ユニットテストが全て通る

## ✅ コード品質
- [ ] 関数名・変数名が意味のある名前になっている
- [ ] 1つの関数が50行以下
- [ ] force unwrap (!) を使っていない
- [ ] マジックナンバー・ハードコード文字列がない
- [ ] 不要なコメントやデバッグコードが残っていない
- [ ] 同じ処理がコピペで重複していない（DRY原則）

## ✅ アーキテクチャ
- [ ] View にビジネスロジックが入っていない
- [ ] ViewModel が UI フレームワークに依存していない
- [ ] データの流れが一方向（View → ViewModel → Service）

## ✅ iOS固有
- [ ] Dynamic Type で文字サイズを変えてもレイアウトが崩れない
- [ ] ダークモードで色が正しく表示される
- [ ] VoiceOver で全要素にアクセスできる
- [ ] SF Symbols を使用している
- [ ] タップターゲットが最小44pt × 44ptを満たしている

## ✅ パフォーマンス
- [ ] メインスレッドをブロックする処理がない
- [ ] 不要な再レンダリングが発生していない
- [ ] 画像の遅延読み込み / キャッシュが実装されている（該当する場合）

## ✅ セキュリティ
- [ ] APIキー・シークレットがコードに含まれていない
- [ ] ユーザー入力がバリデーション・サニタイズされている
- [ ] HTTPS通信のみを使用している

## ✅ 回帰・副作用
- [ ] 既存の機能が壊れていない
- [ ] 不要なファイルの変更が含まれていない
- [ ] .pbxproj を直接変更していない

---

# App Store 審査チェックリスト

## 必須対応
- [ ] プライバシーポリシーURL が設定されている
- [ ] Info.plist の全 Usage Description が適切に記述されている
- [ ] ログイン必須の場合、テストアカウント情報を審査メモに記載
- [ ] IPv6環境で動作する
- [ ] 全画面サイズ（SE〜Pro Max）でUIが正常に表示される
- [ ] スプラッシュ画面後にすぐ使える状態になる

## 品質基準
- [ ] クラッシュしない（クラッシュフリー率99.5%以上）
- [ ] 全画面に空状態・エラー状態の表示がある
- [ ] 戻るボタン・閉じるボタンが全モーダルにある
- [ ] デッドリンクやプレースホルダーテキストが残っていない
- [ ] スクリーンショットとアプリの実際の画面が一致している

## メタデータ
- [ ] アプリ名（30文字以内）
- [ ] サブタイトル（30文字以内）
- [ ] 説明文（4000文字以内）
- [ ] キーワード（100文字以内）
- [ ] スクリーンショット（6.7", 6.5", 5.5" の3サイズ）
- [ ] アプリアイコン（1024 × 1024px）
- [ ] カテゴリ設定
- [ ] 年齢レーティング
