# PositiveVoice 機能アップデート設計書

**バージョン**: 2.0
**作成日**: 2026-02-07
**ステータス**: レビュー待ち

---

## 1. 概要

### 1.1 目的
PositiveVoice v1.0のシンプルな機能を拡張し、ユーザーエンゲージメントを高めるとともに、より温かみのあるブランドイメージを確立する。

### 1.2 主な変更点
- ブランディング刷新（名称・カラースキーム）
- 画像投稿機能
- ソーシャル機能（コメント、フォロー、ブックマーク）
- シェア機能
- ダークモード対応
- UIアニメーション強化
- プッシュ通知

---

## 2. ブランディング刷新

### 2.1 投稿タイプの名称変更

| 現在 | 変更案 | コンセプト |
|------|--------|-----------|
| 今日のいいこと | **きょうのひかり** | 日常の小さな光・希望を表現 |
| こうなって欲しい世の中 | **みらいのたね** | 理想の種をまくイメージ |

**代替案:**
| 案 | タイプA | タイプB |
|----|---------|---------|
| 案1 | きょうのひかり | みらいのたね |
| 案2 | 小さなしあわせ | 願いのかたち |
| 案3 | ほっとひといき | あしたへの想い |
| 案4 | いいことメモ | 世界へのねがい |

### 2.2 カラースキーム変更

**現在（グリーン系）:**
```
Primary: #4CAF50 (緑)
Secondary: #FF9800 (オレンジ)
```

**変更後（オレンジ系・温かみ）:**
```
Primary:     #FF8C42 (温かいオレンジ)
Secondary:   #FFD166 (明るいイエロー)
Accent:      #F4845F (コーラル)
Background:  #FFF8F0 (クリーム)
Surface:     #FFFFFF (白)
TextPrimary: #5D4037 (ブラウン)
TextSecondary: #8D6E63 (ライトブラウン)
Success:     #7CB342 (ライトグリーン)
Error:       #E57373 (ソフトレッド)
```

**グラデーション:**
```
Warm Gradient: #FF8C42 → #FFD166
Sunset Gradient: #F4845F → #FF8C42 → #FFD166
```

### 2.3 アプリアイコン
現在のアイコン（吹き出し + 太陽）はオレンジ系で既に適合。変更不要。

---

## 3. 機能追加詳細

### 3.1 画像投稿機能

**概要:** 投稿にテキストに加えて画像を添付可能にする

**仕様:**
- 最大画像数: 4枚/投稿
- 対応フォーマット: JPEG, PNG, HEIC
- 最大ファイルサイズ: 5MB/枚
- 自動リサイズ: 長辺1080px
- 画像保存先: AWS S3 (positivevoice-media-dev-*)

**UI変更:**
```
投稿作成画面
┌─────────────────────────────┐
│ [×]          投稿する [送信] │
├─────────────────────────────┤
│ ┌─────────────────────────┐ │
│ │                         │ │
│ │    テキスト入力エリア    │ │
│ │                         │ │
│ └─────────────────────────┘ │
│                             │
│ ┌────┐ ┌────┐ ┌────┐ ┌────┐│
│ │ +  │ │img1│ │img2│ │    ││
│ │画像│ │    │ │    │ │    ││
│ └────┘ └────┘ └────┘ └────┘│
│                             │
│ [きょうのひかり] [みらいのたね]│
└─────────────────────────────┘
```

**データモデル変更:**
```swift
struct Post {
    let id: String
    let userId: String
    let type: PostType
    let content: String
    let imageUrls: [String]  // 追加
    let category: PostCategory
    let createdAt: Date
}
```

**バックエンド変更:**
- S3署名付きURL生成API追加
- DynamoDB PostsTableに`imageUrls`属性追加

---

### 3.2 コメント機能

**概要:** 投稿に対してコメントを付けられる

**仕様:**
- コメント文字数: 最大100文字
- コメント表示: 最新3件 + 「すべて見る」
- コメント削除: 自分のコメントのみ

**UI:**
```
投稿詳細画面
┌─────────────────────────────┐
│ [←]        投稿詳細          │
├─────────────────────────────┤
│ [アイコン] ニックネーム       │
│ 投稿テキスト...              │
│ [画像があれば表示]           │
│ 2時間前 • カテゴリ           │
├─────────────────────────────┤
│ コメント (5)                 │
│                             │
│ [アイコン] ユーザーA         │
│ コメント内容...              │
│                             │
│ [アイコン] ユーザーB         │
│ コメント内容...              │
│                             │
│ すべてのコメントを見る →     │
├─────────────────────────────┤
│ [コメントを入力...]    [送信] │
└─────────────────────────────┘
```

**データモデル:**
```swift
struct Comment {
    let id: String
    let postId: String
    let userId: String
    let content: String
    let createdAt: Date
}
```

**バックエンド変更:**
- DynamoDB CommentsTable新規作成
- コメントCRUD API追加

---

### 3.3 ブックマーク機能

**概要:** 気に入った投稿を保存して後から見返せる

**仕様:**
- ブックマーク上限: 無制限
- 保存場所: ローカル + クラウド同期

**UI:**
- 投稿カードにブックマークアイコン追加
- プロフィール画面に「ブックマーク」タブ追加

```
投稿カード
┌─────────────────────────────┐
│ [アイコン] ニックネーム  [🔖] │  ← ブックマークアイコン
│ 投稿テキスト...              │
└─────────────────────────────┘
```

**データモデル:**
```swift
struct Bookmark {
    let userId: String
    let postId: String
    let createdAt: Date
}
```

---

### 3.4 シェア機能

**概要:** 投稿をSNSや他のアプリにシェア

**仕様:**
- iOS標準のShareSheet使用
- シェア内容: テキスト + アプリリンク
- 対応: Twitter, LINE, Instagram, その他

**UI:**
- 投稿カード/詳細画面にシェアボタン追加

**実装:**
```swift
// iOS標準ShareSheet
let shareText = "\(post.content)\n\n#PositiveVoice"
let activityVC = UIActivityViewController(
    activityItems: [shareText],
    applicationActivities: nil
)
```

---

### 3.5 フォロー機能

**概要:** 気になるユーザーをフォローしてタイムラインに表示

**仕様:**
- フォロー/フォロワー表示
- フォロー中のユーザーの投稿をタイムラインに表示
- おすすめユーザー表示

**UI変更:**

```
プロフィール画面
┌─────────────────────────────┐
│ [設定]                      │
│                             │
│        [アイコン]           │
│        ニックネーム         │
│     10投稿 • 5フォロワー     │
│                             │
│ [きょうのひかり][みらいのたね][ブックマーク] │
├─────────────────────────────┤
│ 投稿一覧...                  │
└─────────────────────────────┘
```

```
他ユーザープロフィール
┌─────────────────────────────┐
│ [←]      ユーザー名          │
│                             │
│        [アイコン]           │
│        ニックネーム         │
│     10投稿 • 5フォロワー     │
│                             │
│      [フォローする]          │
├─────────────────────────────┤
│ 投稿一覧...                  │
└─────────────────────────────┘
```

**データモデル:**
```swift
struct Follow {
    let followerId: String  // フォローする人
    let followeeId: String  // フォローされる人
    let createdAt: Date
}
```

**バックエンド変更:**
- DynamoDB FollowsTable新規作成
- フォロー/アンフォローAPI
- フォロー中ユーザーの投稿取得API

---

### 3.6 ダークモード

**概要:** 目に優しい暗いテーマを提供

**カラースキーム（ダーク）:**
```
Background:    #1A1A1A
Surface:       #2D2D2D
Primary:       #FFB266 (明るいオレンジ)
Secondary:     #FFE0A3 (明るいイエロー)
TextPrimary:   #F5F5F5
TextSecondary: #BDBDBD
```

**実装:**
```swift
// SwiftUI環境変数で自動切り替え
@Environment(\.colorScheme) var colorScheme

// カラー定義
static var background: Color {
    Color(colorScheme == .dark ? "#1A1A1A" : "#FFF8F0")
}
```

**設定:**
- システム設定に従う（デフォルト）
- 常にライト
- 常にダーク

---

### 3.7 UIアニメーション

**追加するアニメーション:**

| 場所 | アニメーション | 種類 |
|------|--------------|------|
| スプラッシュ | ロゴフェードイン + スケール | Spring |
| 投稿カード | 表示時スライドイン | EaseOut |
| ブックマーク | ハートバウンス | Spring |
| 画面遷移 | スライド + フェード | EaseInOut |
| プルリフレッシュ | カスタムローディング | Rotation |
| 投稿成功 | 紙飛行機アニメーション | Path |
| タブ切り替え | スムーズスライド | Spring |

**実装例:**
```swift
// 投稿カード表示アニメーション
.transition(.asymmetric(
    insertion: .move(edge: .bottom).combined(with: .opacity),
    removal: .opacity
))
.animation(.spring(response: 0.5, dampingFraction: 0.8), value: posts)
```

---

### 3.8 プッシュ通知

**概要:** 重要なイベントをユーザーに通知

**通知タイプ:**
| タイプ | トリガー | 優先度 |
|--------|---------|--------|
| 新規コメント | 自分の投稿にコメント | 高 |
| 新規フォロワー | フォローされた | 中 |
| おすすめ投稿 | 日次レコメンド | 低 |
| リマインダー | 投稿促進 | 低 |

**設定画面:**
```
通知設定
┌─────────────────────────────┐
│ コメント通知        [ON/OFF] │
│ フォロー通知        [ON/OFF] │
│ おすすめ通知        [ON/OFF] │
│ リマインダー        [ON/OFF] │
└─────────────────────────────┘
```

**バックエンド:**
- AWS SNS / APNs連携
- Lambda通知送信関数

---

## 4. 画面遷移図

```
                    ┌─────────────┐
                    │  スプラッシュ │
                    └──────┬──────┘
                           │
              ┌────────────┴────────────┐
              │                         │
        ┌─────▼─────┐            ┌─────▼─────┐
        │オンボーディング│            │   ホーム   │
        └─────┬─────┘            └─────┬─────┘
              │                         │
        ┌─────▼─────┐     ┌─────────────┼─────────────┐
        │   認証    │     │             │             │
        └─────┬─────┘     │             │             │
              │      ┌────▼────┐  ┌────▼────┐  ┌────▼────┐
              │      │  検索   │  │プロフィール│  │  設定   │
              │      └────┬────┘  └────┬────┘  └─────────┘
              │           │           │
              │      ┌────▼────┐  ┌───▼────┐
              └──────▶ 投稿詳細 │  │他ユーザー│
                     └────┬────┘  └───┬────┘
                          │           │
                     ┌────▼────┐      │
                     │コメント一覧│◀────┘
                     └─────────┘
```

---

## 5. データベース設計

### 5.1 DynamoDB テーブル

**PostsTable (更新)**
```
PK: postId (String)
Attributes:
  - userId (String)
  - type (String): "light" | "seed"
  - content (String)
  - imageUrls (List<String>)  // 追加
  - category (String)
  - commentCount (Number)     // 追加
  - createdAt (String)

GSI:
  - type-createdAt-index
  - userId-createdAt-index
```

**CommentsTable (新規)**
```
PK: commentId (String)
Attributes:
  - postId (String)
  - userId (String)
  - content (String)
  - createdAt (String)

GSI:
  - postId-createdAt-index
```

**FollowsTable (新規)**
```
PK: followerId#followeeId (String)
Attributes:
  - followerId (String)
  - followeeId (String)
  - createdAt (String)

GSI:
  - followerId-index
  - followeeId-index
```

**BookmarksTable (新規)**
```
PK: userId#postId (String)
Attributes:
  - userId (String)
  - postId (String)
  - createdAt (String)

GSI:
  - userId-createdAt-index
```

---

## 6. API設計

### 6.1 新規エンドポイント

| メソッド | パス | 説明 |
|---------|------|------|
| POST | /posts/{id}/comments | コメント投稿 |
| GET | /posts/{id}/comments | コメント一覧取得 |
| DELETE | /comments/{id} | コメント削除 |
| POST | /users/{id}/follow | フォロー |
| DELETE | /users/{id}/follow | アンフォロー |
| GET | /users/{id}/followers | フォロワー一覧 |
| GET | /users/{id}/following | フォロー中一覧 |
| POST | /bookmarks/{postId} | ブックマーク追加 |
| DELETE | /bookmarks/{postId} | ブックマーク削除 |
| GET | /bookmarks | ブックマーク一覧 |
| POST | /media/upload-url | S3アップロードURL取得 |

---

## 7. 実装フェーズ

### Phase 1: ブランディング刷新
1. カラースキーム変更
2. 名称変更（きょうのひかり / みらいのたね）
3. フォント・スタイル調整

### Phase 2: 基本機能拡張
1. 画像投稿機能
2. ブックマーク機能
3. シェア機能

### Phase 3: ソーシャル機能
1. コメント機能
2. フォロー機能
3. 他ユーザープロフィール

### Phase 4: UX向上
1. ダークモード
2. UIアニメーション
3. プッシュ通知

---

## 8. 技術的考慮事項

### 8.1 画像処理
- クライアント側でリサイズしてからアップロード（通信量削減）
- プレースホルダー表示で体感速度向上
- キャッシュ戦略（NSCache + ディスクキャッシュ）

### 8.2 オフライン対応
- ブックマークはローカル優先
- 投稿キュー（オフライン時は保存、オンライン復帰時に送信）

### 8.3 パフォーマンス
- 画像の遅延読み込み（LazyVStack）
- ページネーション（無限スクロール）
- デバウンス（検索入力）

### 8.4 セキュリティ
- 画像アップロードは署名付きURL使用
- コメント・投稿のサニタイズ
- レート制限

---

## 9. 未決定事項

- [ ] 投稿タイプ名称の最終決定
- [ ] コメントへの返信機能の有無
- [ ] ブロック/ミュート機能の必要性
- [ ] 通知の頻度設定

---

## 10. レビュー依頼事項

シニアエンジニアに確認いただきたい点：

1. **データモデル設計** - DynamoDBのテーブル構成は適切か
2. **API設計** - RESTful設計として問題ないか
3. **実装フェーズ分け** - 優先順位は妥当か
4. **技術選定** - 画像処理やキャッシュ戦略に改善点はあるか
5. **セキュリティ** - 考慮漏れはないか

---

**作成者:** Claude Code
**レビュー担当:** [シニアエンジニア名]
**承認日:** [承認後記入]
